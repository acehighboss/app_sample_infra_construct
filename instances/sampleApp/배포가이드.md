
```
인프라가 성공적으로 구축되었는지, 보안 솔루션(WAF 등)이 제대로 작동하는지 시각적으로 보여줄 웹 애플리케이션이 있으면 프로젝트 결과를 발표할 때 매우 효과적입니다.
웹 개발자는 아니므로 가장 배포하기 쉬우면서도 프로젝트의 목적(보안 테스트)에 부합하는 간단한 애플리케이션을 생성해서 사용함.
- 웹 앱 자체는 문제가 없다는 가정하에 인프라 구축에 집중하기 위함

추천: 간단한 PHP 방명록 (Guestbook)
    배포가 매우 쉽습니다: 
    DB 연결을 테스트합니다: 
        Public Subnet의 EC2가 Private Subnet의 RDS(DB)와 통신하는 핵심 아키텍처를 증명할 수 있습니다.
    WAF 테스트에 완벽합니다: 
        방명록의 '이름'이나 '내용' 입력 폼은 **XSS(크로스 사이트 스크립팅)**나 SQL Injection 같은 웹 공격을 테스트하기에 이상적입니다. (예: WAF를 켜기 전/후 비교 시연)
```

EC2에 Node.js 방명록 배포 가이드 (Amazon Linux 2)

이 가이드는 EC2 인스턴스에 Node.js를 설치하고, pm2를 사용해 방명록 앱을 안정적으로 배포하는 방법

1단계: EC2 인스턴스에 SSH 접속

Terraform으로 생성한 Bastion Host 또는 Public EC2에 SSH로 접속합니다.

ssh -i "your-key.pem" ec2-user@<EC2_PUBLIC_IP_ADDRESS>

2단계: Node.js 설치 (NVM 사용)

EC2 인스턴스에서 nvm(Node Version Manager)을 사용하여 안정적인 최신 버전의 Node.js(예: 18.x)를 설치합니다.

```
# 1. NVM 설치 스크립트 다운로드 및 실행
curl -o- [https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh](https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh) | bash

# 2. NVM을 현재 세션에 적용
source ~/.bashrc

# 3. Node.js LTS(Long Term Support) 버전 설치 (v18.x)
nvm install 18

# 4. 설치 확인 (v18.x.x 버전이 출력되어야 함)
node -v
npm -v
```

3단계: 애플리케이션 파일 업로드 및 준비

1. 새 디렉토리를 만들고 이동합니다.

```
mkdir my-app

cd my-app
```

nano 또는 vim 편집기를 사용하여, 제공된 5개의 파일 
    server.js, 
    db-setup.js, 
    package.json, 
    views/index.ejs, 
    .env.example

을 생성하고 내용을 붙여넣습니다.
특히 .env.example 파일은 .env로 저장해야 합니다.

```
# 예시
nano package.json
# (내용 붙여넣기 후 Ctrl+X, Y, Enter로 저장)

nano server.js
# (내용 붙여넣기 후 저장)

mkdir views
nano views/index.ejs
# (내용 붙여넣기 후 저장)

nano db-setup.js
# (내용 붙여넣기 후 저장)

nano .env
# (.env.example 내용을 붙여넣고, 실제 RDS 정보로 수정한 후 저장)
```

4단계: db_config.php 파일 수정 (이전 단계에서 이름 변경됨)

.env 파일을 열어 Terraform Output으로 확인한 RDS 엔드포인트, DB 이름, 사용자, 비밀번호를 정확히 입력합니다.

```
nano .env
```

5단계: 앱 설치 및 DB 테이블 생성

package.json에 명시된 의존 모듈(express, mysql2 등)을 설치합니다.

```
npm install
```

DB 테이블 생성 스크립트를 최초 1회 실행합니다.

```
npm run setup 
# 또는: node db-setup.js
```

"테이블이 성공적으로 준비되었습니다"라는 메시지가 뜨는지 확인합니다.

6단계: 애플리케이션 실행 (PM2 사용)

node server.js로 실행할 수도 있지만, SSH 접속이 끊기면 앱도 종료됩니다. 따라서 pm2라는 프로세스 매니저를 사용하여 앱이 백그라운드에서 계속 실행되도록 합니다.

```
# 1. pm2를 글로벌로 설치
sudo npm install pm2 -g

# 2. 앱 실행
pm2 start server.js

# 3. (선택) EC2 재부팅 시에도 pm2 앱이 자동 시작되도록 설정
pm2 startup
# (화면에 나타나는 'sudo env ...' 명령어를 복사하여 실행해줍니다)
```

7단계: 접속 및 WAF 테스트

이 Node.js 앱은 3000번 포트에서 실행됩니다.

1. Terraform 설정 확인:
    EC2의 **보안 그룹(Security Group)**이 Port 3000에 대한 인바운드 트래픽을 허용하는지 확인해야 합니다.
    (중요) WAF를 ALB(Application Load Balancer)에 연결했다면, ALB의 **대상 그룹(Target Group)**이 EC2의 Port 3000을 가리키도록 설정해야 합니다. (이것이 표준 구성입니다)
2. 접속:
    ALB의 DNS 주소(예: http://my-alb-xxxx.ap-northeast-2.elb.amazonaws.com)로 접속합니다.
3. WAF 테스트:
    '메시지' 란에 <script>alert('XSS Test');</script> 를 입력합니다.
    WAF 비활성화 시: 글이 등록되고, 페이지를 다시 볼 때 경고창이 뜹니다. (XSS 성공)
    WAF 활성화 시: WAF가 요청을 차단하여 "403 Forbidden" 오류가 발생합니다. (XKSS 방어 성공)

